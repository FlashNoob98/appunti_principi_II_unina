Si consideri un circuito RC serie
\begin{figure}[H]\centering
\begin{circuitikz}
\draw
(0,0) to [voltage source,invert,l=$u(t)$] (0,2)
      to [R=$R$] (2,2)
      to [C,l_=$C$,v^=$v_C$] (2,0) -- (0,0)
;
\end{circuitikz}
\end{figure}
si suppone che la tensione imposta al generatore sia un gradino unitario $u(t)$,
l'equazione di stato sarà:
$$
\begin{cases}
u(t) = RC \frac{dv_C}{dt} + v_C \\
v_C(0^+) = 0
\end{cases}
\Rightarrow v_C(t) = \left.
\begin{cases}
0 & t<0 \\
1-e^{-\frac{t}{\tau}} & t\geq 0
\end{cases}\right] = g(t)
$$

Si considera la funzione $U_\Delta$
$$U_\Delta(t) = 
\begin{cases}
0 & t< -\frac{\Delta}{2}\\
\frac{1}{2} + \frac{t}{\Delta} & -\frac{\Delta}{2} < t < \frac{\Delta}{2} \\
1 & t > \frac{\Delta}{2}
\end{cases}
$$
se si esegue la differenza di due funzioni $U_\Delta$ traslate di $\pm\frac{\Delta}{2}$ si ottiene 
una porta trapezoidale
$$
f(t) = \frac{U_\Delta\left(t+\frac{\Delta}{2}\right) - U_\Delta\left(t-\frac{\Delta}{2}\right)}{\Delta}
$$
tende ad una $\delta(t)$ delta di Dirac per $\Delta \rightarrow 0$.
Semplicemente si può invece definire la porta come differenza di due gradini traslati, in questo modo
si elimina il problema dei segmenti obliqui.

La linearità del sistema e la tempo-invarianza delle grandezze dei bipoli implica che la
risposta ad una combinazione lineare di funzioni traslate nel tempo si ottiene come combinazione lineare 
delle risposte dei singoli termini traslati.
$$
\text{Risp}\left\{\Pi_\Delta(t)\right\} = \frac{\text{Risp}\left\{u\left(t+\frac{\Delta}{2}\right) \right\} -\text{Risp}\left\{ u\left(t-\frac{\Delta}{2}\right) \right\}}{\Delta} = \frac{g\left(t+\frac{\Delta}{2}\right)-
g\left(t-\frac{\Delta}{2}\right)}{\Delta}
$$
Eseguendo il limite per $\Delta\to 0^+ $ si vede che quello appena presentato è un rapporto incrementale e
quindi
$$
\lim_{\Delta\to0^+} \Rightarrow \text{Risp} \left\{\delta(t)\right\} =h(t) = \frac{dg}{dt}
$$
Ricordando le funzioni $h(t)$ e $g(t)$ si vede la relazione
$$
h(t) = \begin{cases}
0 & t<0\\
\frac{1}{\tau}e^{-\frac{t}{\tau}} & t\geq 0
\end{cases}\qquad
g(t) = \begin{cases}
0 & t<0\\
1 - e^{-\frac{t}{\tau}} & t\geq 0
\end{cases} \Rightarrow
\frac{dg}{dt} = h(t)
$$
è possibile studiare la risposta all'impulso sfruttando quella al gradino, che è una funzione limitata e 
più semplice da analizzare.

\paragraph{Circuiti RC ed RL semplici con generatori impulsivi}
Si considerino 2 circuiti modello: il circuito RC parallelo e il circuito RL serie.

\begin{figure}[H]\centering
\begin{subfigure}{.4\textwidth}\centering
\begin{circuitikz}
\draw
(0,0) to [current source,l=$j(t)$] (0,2)
      to (1,2) to [R=$R$,i>^=$i_R$] (1,0) to (0,0);
\draw
(1,2) to (2.5,2)  to [C,l_=$C$,v^=$v_C(t)$,i>_=$i_C$] (2.5,0) -- (1,0)
;
\end{circuitikz}
\subcaption{RC parallelo}
\end{subfigure}
\begin{subfigure}{.4\textwidth}\centering
\begin{circuitikz}
\draw
(0,0) to [voltage source,invert,l=$e(t)$] (0,2)
      to [R,l_=$R$] (2.5,2) to [L,l_=$L$,i_>=$i_L(t)$,v^=$v_L$] (2.5,0) -- (0,0)
;
\end{circuitikz}
\subcaption{RL serie}
\end{subfigure}
\end{figure}

Siano i generatori impulsivi: $j(t) = Q\delta(t)$ ed $e(t) = \Phi\delta(t)$.
$$
j(t) = \frac{v_C}{R} + i_C = Q\delta(t) = \frac{v_C}{R} + C\frac{dv_C}{dt}
$$
Si integra la funzione nell'istante in cui è centrata la $\delta(t)$ ossia:
$$
\int_{0^-}^{0^+} Q\delta(\tau)d\tau  = \cancel{\int_{0^-}^{0^+}\frac{v_C}{R}d\tau} + C[v_C(0^+)-\cancel{v_C(0^-)}]
\Leftrightarrow Q = Cv_C(0^+) \ \ [Q] = \si{\coulomb} \text{ (Coulomb)}
$$
$$
\left[\int_{0^-}^{0^+} Q\delta(\tau)d\tau\right] = \text{ Coulomb}
$$
Tirando la costante $C$ fuori dall'integrale, che ha la dimensione di Coulomb, l'integrale rimanente
deve essere adimensionale.
Ciò significa che la $\delta(t)$ ha la dimensione di \si{\per\second} per essere coerente con l'integrale
e restituire una quantità finita.

\subparagraph{Caso duale con circuito RL:}

$$
e(t) = R\cdot i_L + v_L
$$
$$
\Phi\delta(t) = R\cdot i_L + L\frac{di_L}{dt}
$$
$$
\Phi\int_{0^-}^{0^+} \delta(\tau)d\tau = L i_L(0^+)\ , \ i_L(0^-) = 0
$$

Anche in questo caso per avere la dimensione del flusso in \si{\weber} per $\Phi$ allora la $\delta(t)$ 
avrà le dimensioni di \si{\per\second}.
\newpage
\subsection{Procedura generale per la risoluzione di circuiti con generatori impulsivi}
Si ha un circuito dinamico semplice al quale è collegato un generatore impulsivo,
si determina il circuito resistivo associato, ossia vengono sostituiti i condensatori con 
generatori di tensione e gli induttori con generatori di corrente.

Si ottiene un circuito parziale in cui si spengono i generatori interni (anche quelli equivalenti ai bipoli dinamici) e si lascia agire solo il generatore impulsivo.

Un ulteriore circuito è ottenuto facendo l'esatto contrario e spegnendo quindi il generatore impulsivo.

\begin{figure}[H]\centering
\begin{subfigure}{0.45\linewidth}\centering
\includegraphics[width=\linewidth]{lezione_03_circuito_A}
\subcaption{Circuito iniziale}
\end{subfigure}
\begin{subfigure}{0.45\linewidth}\centering
\includegraphics[width=\linewidth]{lezione_03_circuito_B}
\subcaption{Circuito resistivo associato}
\end{subfigure}
\begin{subfigure}{0.45\linewidth}\centering
\includegraphics[width=\linewidth]{lezione_03_circuito_C-}
\subcaption{Circuito C'}
\end{subfigure}
\begin{subfigure}{0.4\linewidth}\centering
\includegraphics[width=\linewidth]{lezione_03_circuito_C--}
\subcaption{Circuito C"}
\end{subfigure}
\end{figure}
È sempre necessario determinare la dinamica dello stato, in modo da ridurre tutte le equazioni circuitali
ad un'equazione differenziale e non algebrico-differenziale, in seguito si ricavano le restanti 
variabili mediante operazioni algebriche.

Si applica il PSE (Principio di Sovrapposizione degli effetti)
$$
\begin{cases}
v_L = v_L' + v_L''\\
i_C = i_C' + i_C''
\end{cases}
$$

Dal circuito C' si ricavano $v_L'$ e $i_C'$ in funzione dei generatori impulsivi, si determineranno le 
discontinuità delle variabili di stato $i_L$ e $v_C$ a $t=0$.

Viceversa dal circuito C'' si valutano le variabili di stato utilizzando le condizioni iniziali
ricavate in C'.

$$
v_C(0^+) = \frac{1}{C} \int_{0^-}^{0^+} i_C'(\tau)d\tau \ , \ v_C(0^-) = 0
$$
$$
i_L(0^+) = \frac{1}{L} \int_{0^-}^{0^+} i_L'(\tau)d\tau \ , \ i_L(0^-) = 0
$$
L'integrale delle variabili di stato del circuito C'' è pari a 0 dato che la funzione integranda è limitata
e l'intervallo è infinitesimo.

Infine si risolve il circuito C'' usando le variabili di stato appena calcolate in C'.

In sintesi per analizzare un circuito con generatori impulsivi bisogna determinare le condizioni iniziali
utilizzando un circuito ausiliario in cui i generatori non impulsivi sono spenti e ogni induttore e condensatore
è sostituito da un circuito aperto o un corto circuito.

\subsection{Esempio risposta impulsiva circuito del secondo ordine}
Si vuole risolvere il seguente circuito del secondo ordine
\begin{figure}[H]\centering
\begin{circuitikz}
\draw
(0,0) to [R,l=$R_1$] (0,2) to (2,2)
      to [C,l_=$C$,i>_=$i_C$,v^=$v_C$] (2,0) to (0,0);
\draw
(2,2) to [R,l_=$R_2$,i^=$i(t)$] (4,2)
      to [L,l_=$L$,i=$i_L$] (4,0) to (2,0)
;
\draw
(4,2) to (5,2) to [current source,invert,l=$\delta(t)$] (5,0) to (4,0);
\end{circuitikz}
\caption*{Circuito C'}
\end{figure}

Si vuole determinare la risposta impulsiva per la variabile $i(t)$ che non è una variabile di stato.
Si procede con il metodo risolutivo sostituendo i bipoli dinamici con i rispettivi generatori chiusi 
o aperti
\begin{figure}[H]\centering
\begin{circuitikz}
\draw
(0,0) to [R,l=$R_1$] (0,2) to (2,2)
      to [short,i>_=$i_C'$] (2,0) to (0,0);
\draw
(2,2) to [R,l_=$R_2$,i^=$i'(t)$] (4,2)
      to [open,v=$v_L'$] (4,0) to (2,0)
;
\draw
(4,2) to (5,2) to [current source,invert,l=$\delta(t)$] (5,0) to (4,0);
\end{circuitikz}
\end{figure}

Il resistore $R_1$ è in parallelo ad un corto circuito, di conseguenza si vede che la corrente
$i_C'(t)$ è pari a $\delta(t)$ mentre $v_L' = R_2\delta(t)$

Si ricavano le variabili di stato
\begin{align*}
v_C(0^+) &= \frac{1}{C}\int_{0^-}^{0^+} i_C' d\tau = \frac{1}{C} \int_{0^-}^{0^+}\delta(\tau)d\tau = \frac{1}{C}\\
i_L(0^+) &= \frac{1}{L}\int_{0^-}^{0^+} v_L' d\tau = \frac{1}{L} \int_{0^-}^{0^+}R_2\delta(\tau)d\tau = \frac{R_2}{L}
\end{align*}

Si risolve il circuito C'' per determinare le equazioni di stato introducendo i generatori sostitutivi

\begin{figure}[H]\centering
\begin{circuitikz}
\draw
(0,0) to [R,l=$R_1$] (0,2) to (2,2)
      to [voltage source,i>_=$i_C''$,v^=$v_C$] (2,0) to (0,0);
\draw
(2,2) to [R,l_=$R_2$,i^=$i''(t)$] (4,2)
      to [current source,l_=$i_L$,v^>=$v_L''$] (4,0) to (2,0)
;
\end{circuitikz}
\caption*{Circuito C''}
\end{figure}

Applicando il PSE spegnendo prima il generatore di corrente e poi quello di tensione
\begin{align*}
i_C'' &= -\frac{v_C}{R_1} - i_L= C\frac{dv_C''}{dt}\\
v_L'' &= v_C - R_2i_L = L\frac{di_L''}{dt}
\end{align*}
Quelle appena ottenute sono le equazioni di stato sostituendo le equazioni caratteristiche dei bipoli dinamici.
Si ottiene infine il problema di Cauchy soluzione dello stato del circuito
$$\begin{cases}
C\frac{dv_C''}{dt} = -\frac{v_C}{R_1} - i_L \\
L\frac{di_L''}{dt} = v_C - R_2i_L \\
v_C(0^+) = \frac{1}{C} \\
i_L(0^+) = \frac{R_2}{L}
\end{cases}$$
La richiesta dell'esercizio è trovare la $i(t)$, si applica la LKC al nodo tra 
il resistore $R_2$ e l'induttore
$$
i(t) = i_L - \delta(t)
$$
è quindi sufficiente sottrarre l'impulso $\delta(t)$ alla corrente $i_L$ ricavata risolvendo le
equazioni di stato.

Per ricavare $i_L$ si isola $v_C$ dalla seconda equazione di stato (che contiene anche la derivata di $i_L$)
e la si sostituisce nella prima.
$$
v_C = R_2i_L + L\frac{di_L}{dt}
$$
$$
C \frac{d}{dt}\left[R_2i_L + L\frac{di_L}{dt} \right] = -\frac{R_2}{R_1}i_L - \frac{L}{R_1}\frac{di_L}{dt} - i_L
$$
raccogliendo
$$
LC\frac{d^2i_L}{dt^2} + \left(R_2C +\frac{L}{R_1}\right)\frac{di_L}{dt} + \left(1+\frac{R_2}{R_1}\right)i_L = 0
$$
Eseguendo il controllo dimensionale tutti i termini hanno le dimensioni di una corrente (Ampere).
Si suppone che il circuito sia dissipativo e dunque i resistori con resistenza maggiore di zero,
le radici del polinomio caratteristico hanno dunque parte reale negativa (il transitorio si estingue).
\newpage

Aggiungendo le condizioni iniziali si ottiene il problema di Cauchy
$$\left\{
\begin{aligned}
&LC\frac{d^2i_L}{dt^2} + \left(R_2C +\frac{L}{R_1}\right)\frac{di_L}{dt} + \left(1+\frac{R_2}{R_1}\right)i_L = 0
\\
&i_L(0^+) = \frac{R_2}{L}\\
&\frac{di_L}{dt}(0^+) = \frac{1}{L} \left[v_C(0^+) - R_2i_L(0^+)\right] = \frac{1}{LC} - \frac{R_2^2}{L^2}
\end{aligned}\right.
$$

Si valutano le frequenze naturali del circuito risolvendo il polinomio caratteristico, dividendo tutto per $LC$
$$
\lambda^2 + \left(\frac{R_2}{L} + \frac{1}{R_1C}\right)\lambda + \frac{\left(1+\frac{R_2}{R_1}\right)}{LC}=0
$$

Si suppone che $\lambda_1$ e $\lambda_2$ siano reali e distinte, la soluzione del problema sarà del tipo
$$\begin{aligned}
i_L(t) &= K_1e^{\lambda_1t} + K_2e^{\lambda_2t}\\
i_L(0^+) &=\frac{R_2}{L} = K_1 + K_2\\
\frac{di_L}{dt}(0^+) &= \frac{1}{LC} - \frac{R_2^2}{L^2} = \lambda_1K_1 + \lambda_2K_2
\end{aligned}
$$
La corrente incognita $i(t)$ sarà per quanto visto precedentemente mediante la LKC
$$
i(t) = i_L-\delta(t) = \left(K_1e^{\lambda_1t} + K_2e^{\lambda_2t}\right)u(t) -\delta(t)
$$

Si osserva che le variabili di stato possono essere discontinue ma comunque limitate, le altre
variabili possono invece essere anche impulsive.

\newpage
\paragraph{Risposta forzata di un circuito LTI}
Si suppone di avere un solo generatore esterno, se ne vogliono determinare le variabili ai capi
di un solo bipolo, si parla di filtro o sistema SISO \textit{(Single Input Single Output)},
sia $x(t)$ l'ingresso e $y(t)$ l'uscita, si deve supporre che il circuito sia a stato 0, ossia
le sue variabili di stato sono tutte nulle (circuito precedentemente spento).

Si parla di approssimazione \textit{PieceWise-Constant} ossia costante a tratti dell'ingresso
$x(t)$.
Si partiziona l'asse dei tempi in tanti intervalli di ampiezza $\Delta t$ centrati negli istanti
di tempo $t_k = k\Delta t\ ,\ k\ \in\ Z$.

Si costruisce un'approssimazione $x_\Delta(t)$ costante di valore $x(t_k)$ in $\left[t_k-\frac{\Delta t}{2}\ ,\ 
t_k+\frac{\Delta t}{2}\right]$.
La funzione $x(t)$ può quindi essere rappresentata come somma di impulsi rettangolari successivi,
sfruttando la funzione $\Pi_{\Delta}(t)$, sarà quindi:
$$
x_{\Delta}(t) = \sum_{k = -\infty}^{+\infty} x(t_k) \Pi_\Delta(t-t_k)\Delta t
$$
Eseguendo il limite per $\Delta t \rightarrow 0^+$ in ipotesi di sufficiente regolarità:
$$
\lim_{\Delta t \to 0^+} x_\Delta(t) = x(t) = \int_{-\infty}^{+\infty} x(\tau) \delta (t-\tau)
d\tau
$$
Questa conclusione richiama la proprietà di campionamento della $\delta(t)$.

Se si vuole calcolare la risposta di $x(t)$ allora:
$$
\text{Risp}\left\{x(t)\right\} = y(t) = \text{Risp} \left\{\int_{-\infty}^{+\infty} x(\tau)\delta(t-\tau)
d\tau\right\}
$$
per linearità e tempo-invarianza si ottiene
$$
y(t) = \int_{-\infty}^{+\infty} x(\tau)h(t-\tau) d\tau
$$
chiamato integrale di convoluzione, $h(t)$ è la risposta impulsiva per la variabile di uscita.

Si parla di prodotto di convoluzione tra due funzioni $f,g \ \in\ \mathbb{R}$
$$
f * g(t) = \int_{-\infty}^{+\infty} f(\tau)g(t-\tau)d\tau
$$
Noto l'ingresso $x(t)$ si può calcolare la risposta forzata se si conosce la risposta impulsiva
dello stesso circuito, relativa alla medesima grandezza di uscita.
